<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Assistant Financier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- DESIGN SYSTEM PREMIUM --- */
        body { font-family: 'Outfit', sans-serif; background-color: #050505; color: white; -webkit-tap-highlight-color: transparent; }

        /* Fond animé subtil */
        .bg-gradient-custom {
            background: radial-gradient(circle at 10% 20%, rgba(37, 99, 235, 0.1) 0%, transparent 40%),
                        radial-gradient(circle at 90% 80%, rgba(236, 72, 153, 0.1) 0%, transparent 40%);
        }

        /* Effet Verre "Glassmorphism" Premium */
        .glass {
            background: rgba(22, 22, 26, 0.7);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        /* Inputs ultra ergonomiques */
        .input-field {
            background: #0f0f11;
            border: 1px solid #2c2c30;
            color: white;
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
        }
        .input-field:focus {
            border-color: #6366f1;
            background: #16161a;
            outline: none;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
        }

        /* Onglets */
        .tab-btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0.5; position: relative; }
        .tab-btn.active { opacity: 1; color: white; }
        .tab-btn.active::after {
            content: ''; position: absolute; bottom: -4px; left: 50%; transform: translateX(-50%);
            width: 20px; height: 3px; background: #6366f1; border-radius: 10px;
            box-shadow: 0 0 10px #6366f1;
        }

        .hidden-section { display: none; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 bg-black bg-gradient-custom">

    <div class="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-12 gap-6">

        <div class="lg:col-span-12 flex items-center justify-between mb-2">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 relative">
                    <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="40" height="40" rx="12" fill="url(#paint0_linear)"/>
                        <path d="M12 28L20 12L28 28" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 28H28" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="20" cy="22" r="3" fill="white"/>
                        <defs>
                            <linearGradient id="paint0_linear" x1="0" y1="0" x2="40" y2="40" gradientUnits="userSpaceOnUse">
                                <stop stop-color="#4F46E5"/>
                                <stop offset="1" stop-color="#EC4899"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <div>
                    <h1 class="text-lg font-bold tracking-wide">FINANCE<span class="text-indigo-400">.AI</span></h1>
                    <p class="text-[10px] text-gray-500 uppercase tracking-[0.2em]">Personal Assistant</p>
                </div>
            </div>
        </div>

        <div class="lg:col-span-4 glass rounded-[32px] p-6 lg:p-8 h-fit flex flex-col">

            <div class="flex justify-between items-center mb-8 border-b border-white/10 pb-4">
                <button onclick="switchTab('epargne')" id="tab-epargne" class="tab-btn active text-sm font-semibold tracking-wide">ÉPARGNE</button>
                <button onclick="switchTab('immo')" id="tab-immo" class="tab-btn text-sm font-semibold tracking-wide">CRÉDIT</button>
                <button onclick="switchTab('capacite')" id="tab-capacite" class="tab-btn text-sm font-semibold tracking-wide">CAPACITÉ</button>
            </div>

            <div id="form-epargne" class="space-y-5">
                <div>
                    <label class="text-[11px] font-bold text-indigo-400 uppercase tracking-wider ml-1">Capital de départ</label>
                    <input type="number" inputmode="decimal" id="capital" value="1000" class="input-field w-full rounded-2xl px-4 py-4 text-lg font-medium mt-2">
                </div>
                <div>
                    <label class="text-[11px] font-bold text-indigo-400 uppercase tracking-wider ml-1">Ajout mensuel</label>
                    <input type="number" inputmode="decimal" id="mensuel" value="200" class="input-field w-full rounded-2xl px-4 py-4 text-lg font-medium mt-2">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[11px] font-bold text-gray-500 uppercase tracking-wider ml-1">Taux (%)</label>
                        <input type="number" inputmode="decimal" id="taux" value="5" step="0.1" class="input-field w-full rounded-2xl px-4 py-4 text-lg font-medium mt-2 text-center">
                    </div>
                    <div>
                        <label class="text-[11px] font-bold text-gray-500 uppercase tracking-wider ml-1">Années</label>
                        <input type="number" inputmode="decimal" id="duree" value="15" class="input-field w-full rounded-2xl px-4 py-4 text-lg font-medium mt-2 text-center">
                    </div>
                </div>
                <button onclick="calculerEpargne()" class="w-full py-4 rounded-2xl font-bold text-white mt-4 bg-indigo-600 hover:bg-indigo-500 transition shadow-lg shadow-indigo-500/20">
                    Simuler
                </button>
            </div>

            <div id="form-immo" class="space-y-5 hidden-section">
                <div>
                    <label class="text-[11px] font-bold text-pink-500 uppercase tracking-wider ml-1">Prix du bien</label>
                    <input type="number" inputmode="decimal" id="immo-montant" value="250000" class="input-field w-full rounded-2xl px-4 py-4 text-lg font-medium mt-2">
                </div>
                <div class="flex items-center justify-between px-1">
                    <label class="text-[11px] font-bold text-gray-500 uppercase tracking-wider">Inclure Frais de Notaire (~7.5%)</label>
                    <input type="checkbox" id="notaire-check" checked class="w-5 h-5 accent-pink-500 rounded">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[11px] font-bold text-gray-500 uppercase tracking-wider ml-1">Taux (%)</label>
                        <input type="number" inputmode="decimal" id="immo-taux" value="3.8" step="0.1" class="input-field w-full rounded-2xl px-4 py-4 text-lg font-medium mt-2 text-center">
                    </div>
                    <div>
                        <label class="text-[11px] font-bold text-gray-500 uppercase tracking-wider ml-1">Années</label>
                        <input type="number" inputmode="decimal" id="immo-duree" value="25" class="input-field w-full rounded-2xl px-4 py-4 text-lg font-medium mt-2 text-center">
                    </div>
                </div>
                <button onclick="calculerImmo()" class="w-full py-4 rounded-2xl font-bold text-white mt-4 bg-pink-600 hover:bg-pink-500 transition shadow-lg shadow-pink-500/20">
                    Calculer Mensualité
                </button>
            </div>

            <div id="form-capacite" class="space-y-5 hidden-section">
                <div>
                    <label class="text-[11px] font-bold text-emerald-500 uppercase tracking-wider ml-1">Revenus Mensuels (Net)</label>
                    <input type="number" inputmode="decimal" id="revenus" value="3000" class="input-field w-full rounded-2xl px-4 py-4 text-lg font-medium mt-2">
                </div>
                <div>
                    <label class="text-[11px] font-bold text-gray-500 uppercase tracking-wider ml-1">Charges / Crédits en cours</label>
                    <input type="number" inputmode="decimal" id="charges" value="0" class="input-field w-full rounded-2xl px-4 py-4 text-lg font-medium mt-2">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[11px] font-bold text-gray-500 uppercase tracking-wider ml-1">Taux (%)</label>
                        <input type="number" inputmode="decimal" id="cap-taux" value="3.8" step="0.1" class="input-field w-full rounded-2xl px-4 py-4 text-lg font-medium mt-2 text-center">
                    </div>
                    <div>
                        <label class="text-[11px] font-bold text-gray-500 uppercase tracking-wider ml-1">Années</label>
                        <input type="number" inputmode="decimal" id="cap-duree" value="25" class="input-field w-full rounded-2xl px-4 py-4 text-lg font-medium mt-2 text-center">
                    </div>
                </div>
                <button onclick="calculerCapacite()" class="w-full py-4 rounded-2xl font-bold text-white mt-4 bg-emerald-600 hover:bg-emerald-500 transition shadow-lg shadow-emerald-500/20">
                    Calculer mon enveloppe
                </button>
            </div>
        </div>

        <div class="lg:col-span-8 flex flex-col gap-6">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="glass rounded-[24px] p-6 relative overflow-hidden">
                    <div id="blob-1" class="absolute top-0 right-0 w-32 h-32 bg-indigo-500 rounded-full blur-[60px] opacity-20 -mr-10 -mt-10"></div>
                    <p id="kpi-label-1" class="text-gray-400 text-xs font-bold tracking-widest uppercase">TOTAL</p>
                    <h2 id="kpi-val-1" class="text-4xl font-bold mt-2 tracking-tight">0 €</h2>
                </div>
                <div class="glass rounded-[24px] p-6 relative overflow-hidden">
                    <div id="blob-2" class="absolute top-0 right-0 w-32 h-32 bg-purple-500 rounded-full blur-[60px] opacity-20 -mr-10 -mt-10"></div>
                    <p id="kpi-label-2" class="text-indigo-400 text-xs font-bold tracking-widest uppercase">DÉTAILS</p>
                    <h2 id="kpi-val-2" class="text-4xl font-bold mt-2 tracking-tight text-indigo-400">0 €</h2>
                </div>
            </div>

            <div class="glass rounded-[32px] p-6 flex-1 min-h-[350px] relative">
                <canvas id="financeChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        let myChart;
        Chart.defaults.color = '#6b7280';
        Chart.defaults.font.family = 'Outfit';

        function switchTab(tab) {
            ['epargne', 'immo', 'capacite'].forEach(t => {
                document.getElementById('form-'+t).classList.add('hidden-section');
                document.getElementById('tab-'+t).classList.remove('active');
            });

            document.getElementById('form-'+tab).classList.remove('hidden-section');
            document.getElementById('tab-'+tab).classList.add('active');

            if(tab === 'epargne') calculerEpargne();
            if(tab === 'immo') calculerImmo();
            if(tab === 'capacite') calculerCapacite();
        }

        function formatMoney(amount) {
            return new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(amount);
        }

        function updateKPI(l1, v1, l2, v2, colorClass) {
            document.getElementById('kpi-label-1').innerText = l1;
            document.getElementById('kpi-val-1').innerText = formatMoney(v1);
            document.getElementById('kpi-label-2').innerText = l2;
            document.getElementById('kpi-val-2').innerText = formatMoney(v2);
            document.getElementById('kpi-val-2').className = "text-4xl font-bold mt-2 tracking-tight " + colorClass;
        }

        // --- 1. EPARGNE ---
        function calculerEpargne() {
            const capital = parseFloat(document.getElementById('capital').value) || 0;
            const mensuel = parseFloat(document.getElementById('mensuel').value) || 0;
            const taux = parseFloat(document.getElementById('taux').value) / 100 || 0;
            const duree = parseInt(document.getElementById('duree').value) || 0;

            const labels = []; const dataInv = []; const dataInt = [];

            for (let i = 0; i <= duree; i++) {
                let mois = i * 12;
                let totalVerse = capital + (mensuel * mois);
                let totalReel = taux > 0
                    ? (capital * Math.pow(1 + taux/12, mois)) + (mensuel * ((Math.pow(1 + taux/12, mois) - 1) / (taux/12)))
                    : totalVerse;

                labels.push("Année " + i);
                dataInv.push(totalVerse);
                dataInt.push(totalReel - totalVerse);
            }

            updateKPI("PATRIMOINE TOTAL", dataInv[duree] + dataInt[duree], "INTÉRÊTS GÉNÉRÉS", dataInt[duree], "text-indigo-400");
            drawChart(labels, dataInv, dataInt, "Capital Investi", "Intérêts", '#6366f1', '#a5b4fc');
        }

        // --- 2. IMMOBILIER (Avec Notaire) ---
        function calculerImmo() {
            let montant = parseFloat(document.getElementById('immo-montant').value) || 0;
            const taux = parseFloat(document.getElementById('immo-taux').value) / 100 || 0;
            const duree = parseInt(document.getElementById('immo-duree').value) || 0;
            const withNotaire = document.getElementById('notaire-check').checked;

            // Ajout des frais de notaire (~7.5%) au montant à emprunter
            let montantEmprunte = montant;
            let fraisNotaire = 0;
            if (withNotaire) {
                fraisNotaire = montant * 0.075;
                montantEmprunte += fraisNotaire;
            }

            const nbMois = duree * 12;
            const tm = taux / 12;
            let mensualite = taux > 0 ? montantEmprunte * (tm * Math.pow(1 + tm, nbMois)) / (Math.pow(1 + tm, nbMois) - 1) : montantEmprunte / nbMois;

            const labels = []; const dataCap = []; const dataInt = [];
            let solde = montantEmprunte;
            let cumulInt = 0; let cumulCap = 0;

            for (let m = 0; m <= nbMois; m++) {
                if (m % 12 === 0) {
                    labels.push(m/12 + " ans");
                    dataCap.push(cumulCap);
                    dataInt.push(cumulInt);
                }
                if (m < nbMois) {
                    let intM = solde * tm;
                    let capM = mensualite - intM;
                    solde -= capM;
                    cumulInt += intM;
                    cumulCap += capM;
                }
            }

            // Affichage intelligent
            let detailText = withNotaire ? `DONT NOTAIRE (${formatMoney(fraisNotaire)})` : `COÛT TOTAL CRÉDIT`;
            let detailVal = withNotaire ? cumulInt + fraisNotaire : cumulInt;

            updateKPI("MENSUALITÉ", mensualite, "COÛT CRÉDIT + FRAIS", detailVal, "text-pink-500");
            drawChart(labels, dataCap, dataInt, "Capital Remboursé", "Coût Banque", '#db2777', '#f472b6');
        }

        // --- 3. CAPACITÉ D'EMPRUNT (Nouveau) ---
        function calculerCapacite() {
            const revenus = parseFloat(document.getElementById('revenus').value) || 0;
            const charges = parseFloat(document.getElementById('charges').value) || 0;
            const taux = parseFloat(document.getElementById('cap-taux').value) / 100 || 0;
            const duree = parseInt(document.getElementById('cap-duree').value) || 0;

            // Règle des 35% d'endettement max
            const resteAVivre = revenus - charges;
            const mensualiteMax = resteAVivre * 0.35; // 35% d'endettement

            const nbMois = duree * 12;
            const tm = taux / 12;

            // Formule inversée du crédit pour trouver le capital
            // C = M * (1 - (1+t)^-n) / t
            let capitalMax = 0;
            if (taux > 0) {
                capitalMax = mensualiteMax * (1 - Math.pow(1 + tm, -nbMois)) / tm;
            } else {
                capitalMax = mensualiteMax * nbMois;
            }

            const coutTotal = (mensualiteMax * nbMois) - capitalMax;

            // Pour le graphique, on montre la répartition Capital / Intérêts sur l'enveloppe totale
            const labels = ["Répartition"];

            updateKPI("ENVELOPPE MAX (Bien + Frais)", capitalMax, "MENSUALITÉ MAX (35%)", mensualiteMax, "text-emerald-400");

            // Graphique Donut Spécial pour la capacité
            drawDonut(capitalMax, coutTotal);
        }

        // --- MOTEUR GRAPHIQUE UNIFIÉ ---
        function drawChart(labels, d1, d2, l1, l2, c1, c2) {
            const ctx = document.getElementById('financeChart').getContext('2d');
            if (myChart) myChart.destroy();

            let grad1 = ctx.createLinearGradient(0, 0, 0, 400);
            grad1.addColorStop(0, c1 + '80'); grad1.addColorStop(1, c1 + '00'); // Transparence hex

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: l2, data: d2, borderColor: c2, backgroundColor: c2 + '40', borderWidth: 2, fill: true, tension: 0.4, pointRadius: 0 },
                        { label: l1, data: d1, borderColor: c1, backgroundColor: grad1, borderWidth: 3, fill: true, tension: 0.4, pointRadius: 0 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: 'white', font: { family: 'Outfit' } } } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#52525b' } },
                        y: { grid: { color: '#27272a' }, ticks: { color: '#52525b' }, stacked: true }
                    }
                }
            });
        }

        function drawDonut(capital, interets) {
            const ctx = document.getElementById('financeChart').getContext('2d');
            if (myChart) myChart.destroy();

            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Capital (Le bien)', 'Coût du crédit (Perdu)'],
                    datasets: [{
                        data: [capital, interets],
                        backgroundColor: ['#10b981', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: 'white', padding: 20 } } },
                    cutout: '70%'
                }
            });
        }

        // Init
        switchTab('epargne');
    </script>
</body>
</html>